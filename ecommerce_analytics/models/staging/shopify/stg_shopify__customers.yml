# models/staging/shopify/stg_shopify__customers.yml
version: 2

models:
  - name: stg_shopify__customers
    description: >
      Staging model for Shopify customers with standardized naming and derived fields.
      
      **Source:** Shopify customers table
      
      **Grain:** One row per customer
      
      **Primary Key:** customer_id
      
      **Transformations applied:**
      - Renamed columns for consistency (prefix with customer_)
      - Created full_name from first and last name
      - Generated surrogate key for deduplication scenarios
      - Standardized timestamp column naming
    
    config:
      tags: ['staging', 'shopify', 'daily', 'pii']
      
    columns:
      - name: customer_id
        description: "{{ doc('customer_id') }}"
        tests:
          - unique
          - not_null
      
      - name: customer_email
        description: Customer email address (PII - handle with care)
        tests:
          - not_null
          
      - name: first_name
        description: Customer first name (PII)
        tests:
          - not_null
          
      - name: last_name
        description: Customer last name (PII)
        tests:
          - not_null
          
      - name: full_name
        description: Concatenated full name (first + last)
        tests:
          - not_null
          
      - name: customer_unique_key
        description: Surrogate key combining first_name, last_name, and email for deduplication
        tests:
          - unique
          - not_null
          
      - name: customer_country
        description: Customer country of residence
        tests:
          - accepted_values:
              values: ['France', 'Germany', 'Spain', 'Italy', 'Belgium', 
                       'Netherlands', 'UK', 'Switzerland']
              quote: true
          - not_null
          
      - name: customer_created_at
        description: Timestamp when customer account was created in Shopify
        tests:
          - not_null
          
      - name: customer_updated_at
        description: Timestamp when customer record was last modified
        
      - name: loaded_at_timestamp
        description: Timestamp when data was loaded to Snowflake from source